name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install cppcheck
        run: sudo apt-get update && sudo apt-get install -y cppcheck

      - name: Run cppcheck
        run: |
          # Run cppcheck but don't fail on errors (PostgreSQL code has many external dependencies)
          cppcheck --enable=warning,style,performance \
            --suppress=missingIncludeSystem \
            --suppress=syntaxError \
            --suppress=unknownMacro \
            --inline-suppr \
            freelist.c || true
          echo "Lint check completed"

  static-analysis:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check file exists
        run: |
          ls -la freelist.c
          wc -l freelist.c
          echo "File check passed"

      - name: Check for TODO comments
        run: |
          grep -rn "TODO\|FIXME\|XXX" . --include="*.c" || echo "No TODOs found"
